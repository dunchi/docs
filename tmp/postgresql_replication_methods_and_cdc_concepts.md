# PostgreSQL 복제 방식과 CDC 개념 정리

## 1. PostgreSQL 복제 방식 비교

### Physical Replication (replica)
- 바이너리 레벨에서 데이터 블록을 그대로 복사 (파일 복사와 유사)
- 빠른 성능, 간단한 설정
- 전체 데이터베이스만 복제 가능, 선택적 복제 불가
- 동일한 PostgreSQL 버전 간에만 가능

### Logical Replication (logical)
- SQL 명령어 레벨에서 변경사항을 해석하여 처리
- 테이블 단위 선택적 복제 가능
- 다른 PostgreSQL 버전 간 복제 지원
- 변경 이벤트를 다른 시스템으로 전파 가능 (CDC 구현)
- 상대적으로 복잡한 설정, 성능 오버헤드 존재

### Streaming Replication (스트림 방식)
- 실시간으로 WAL 로그를 전송하여 복제
- Physical과 Logical 모두에서 사용 가능한 방식

## 2. 복제 vs CDC 개념 차이

### 복제 (Replication)
- **목적**: 데이터의 정확한 사본 생성
- **특징**: 원본과 동일한 구조와 데이터 유지
- **예시**: CQRS 구현 시 읽기 전용 복제본 생성
- **활용**: 백업, 읽기 성능 향상, 고가용성

### CDC (Change Data Capture)
- **목적**: 데이터 변경사항의 전파와 활용
- **특징**: 변경 이벤트를 감지하여 다양한 형태로 가공 가능
- **예시**: 변경된 사용자 정보를 알림 서비스, 추천 시스템 등에 전파
- **활용**: 실시간 동기화, 이벤트 기반 아키텍처, 데이터 파이프라인

## 3. CDC (Change Data Capture) 상세

### 정의
데이터베이스 변경사항을 실시간으로 감지하고 다른 시스템에 전파하는 기술

### 구현 내용
- 데이터 변경 이벤트 감지 (INSERT, UPDATE, DELETE)
- 변경 전후 데이터 캡처
- 메시지 큐나 API를 통한 다운스트림 시스템 연동
- 각 서비스가 필요한 데이터를 로컬에 복사본으로 보유

### CDC의 유연성
- 변경 감지한 데이터를 필요에 따라 변환, 필터링, 집계 가능
- 다양한 타겟 시스템에 맞춤형 데이터 전송
- 비즈니스 로직 적용하여 이벤트 처리

### 사용 목적
- 서비스 간 의존성 감소 (직접 API 호출 대신 로컬 데이터 조회)
- 성능 향상 (네트워크 지연 제거)
- 실시간 데이터 동기화
- 높은 가용성 보장

### PostgreSQL에서의 CDC
- 기본적으로 비활성화 상태
- wal_level을 logical로 설정하여 활성화
- 논리적 복제 슬롯을 통해 변경사항 스트리밍

### 트레이드오프
**장점:**
- 성능 향상
- 가용성 증대
- 실시간 반응
- 데이터 활용 유연성

**단점:**
- 시스템 복잡성 증가
- 최종 일관성 모델 (강한 일관성 대신)
